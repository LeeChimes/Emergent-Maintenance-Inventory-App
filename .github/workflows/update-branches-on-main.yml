name: Update PR branches when main changes

on:
  push:
    branches: [ main ]

permissions:
  contents: write
  pull-requests: write

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Update open PRs targeting main
        uses: actions/github-script@v7
        with:
          script: |
            const { owner, repo } = context.repo;
            const prs = await github.paginate(github.rest.pulls.list, {
              owner,
              repo,
              state: 'open',
              base: 'main',
              per_page: 100,
            });
            if (prs.length === 0) {
              core.info('No open PRs targeting main.');
              return;
            }
            for (const pr of prs) {
              try {
                await github.rest.pulls.updateBranch({ owner, repo, pull_number: pr.number });
                core.info(`Updated branch for PR #${pr.number}`);
              } catch (e) {
                core.info(`Skip PR #${pr.number}: ${e.message}`);
              }
            }